<div class="notify">
  <div class="popup" *ngIf="showPopup && popupNotification">
    <div class="popup__eyebrow">Notification</div>
    <div class="popup__title">{{ popupNotification.type || 'Info' }}</div>
    <p class="popup__message">{{ popupNotification.message }}</p>
    <small class="popup__time" *ngIf="popupNotification.dateCreation">
      {{ popupNotification.dateCreation | date:'short' }}
    </small>
    <div class="popup__actions">
      <button hlmButton size="sm" (click)="markPopupAsRead()">Marquer comme lue</button>
      <button hlmButton variant="ghost" size="sm" (click)="closePopup()">Fermer</button>
    </div>
  </div>

  <section class="hero">
    <div>
      <p class="eyebrow">Centre dâ€™alertes</p>
      <h1>Mes notifications</h1>
      <p class="lede">Reste informÃ© des inscriptions, confirmations et mises Ã  jour.</p>
    </div>
  </section>

  <section class="card">
    <div *ngIf="loading" class="info muted">Chargement...</div>
    <div *ngIf="error" class="alert alert--error">{{ error }}</div>

    <div class="list" *ngIf="!loading && notifications.length > 0">
      <article
        class="notif"
        *ngFor="let notif of notifications"
        [ngClass]="{
          'notif--accepted': notif.decision === 'ACCEPTEE',
          'notif--refused': notif.decision === 'REFUSEE'
        }">
        <div class="notif__content">
          <div class="notif__body">
            <div class="notif__head">
              <div class="pill" [class.pill--read]="notif.lue">
                {{ notif.type || 'Info' }}
              </div>
              <span class="time" *ngIf="notif.dateCreation">{{ notif.dateCreation | date:'short' }}</span>
            </div>
            <p class="message" [class.message--read]="notif.lue">{{ notif.message }}</p>
          </div>

          <div class="actions">
            <div class="actions__primary">
              <button
                *ngIf="!notif.lue"
                hlmButton
                size="sm"
                class="btn-read"
                (click)="markAsRead(notif)">
                Marquer comme lue
              </button>
              <span class="status" *ngIf="notif.lue && !notif.decision">DÃ©jÃ  lue</span>
            </div>

            <div
              class="decision"
              *ngIf="isOrganisateur && notif.type === 'NOUVELLE_INSCRIPTION' && notif.eventId && notif.participantId">
              <div class="decision__badge" *ngIf="notif.decision">
                <span [ngClass]="notif.decision === 'ACCEPTEE' ? 'badge badge--accept' : 'badge badge--refuse'">
                  {{ notif.decision === 'ACCEPTEE' ? 'AcceptÃ©e' : 'RefusÃ©e' }}
                </span>
              </div>

              <ng-container *ngIf="!notif.decision; else modifyDecision">
                <button hlmButton size="sm" class="btn-accept" (click)="decideRegistration(notif, 'ACCEPTEE')">
                  Accepter
                </button>
                <button hlmButton size="sm" class="btn-refuse" (click)="decideRegistration(notif, 'REFUSEE')">
                  Refuser
                </button>
              </ng-container>

              <ng-template #modifyDecision>
                <button hlmButton size="sm" class="btn-modify" (click)="resetDecision(notif)">
                  Modifier
                </button>
              </ng-template>
            </div>
          </div>
        </div>

        <button
          class="trash trash-btn"
          hlmButton
          size="sm"
          [disabled]="isOrganisateur && notif.type === 'NOUVELLE_INSCRIPTION' && !notif.lue"
          (click)="deleteNotification(notif)">
          ðŸ—‘
        </button>
      </article>
    </div>

    <div class="empty" *ngIf="!loading && notifications.length === 0">
      Aucune notification pour le moment.
    </div>
  </section>
</div>
